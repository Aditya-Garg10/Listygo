pipeline {
  agent any

  options {
    // don’t do Jenkins’s default checkout (which might grab the wrong branch)
    skipDefaultCheckout()
  }

  stages {
    stage('Checkout Listygo-Prod') {
      steps {
        // clone only your prod branch into the Listygo-Prod folder
        dir('Listygo-Prod') {
          git branch: 'main',                                   // or 'prod' if you use a prod branch
              url:    'https://github.com/Sarman-Keshwani/Listygo-Prod.git'
        }
      }
    }

    stage('Build Docker Image') {
      steps {
        dir('Listygo-Prod') {
          // build the image using the Dockerfile in Listygo-Prod/
          sh 'docker build -t home-frontend .'
        }
      }
    }

    stage('Redeploy') {
      steps {
        sh '''
          # stop & remove old container if it exists
          docker stop home-frontend-1 || true
          docker rm   home-frontend-1 || true

          # launch the new one on port 5173 → container’s 80
          docker run -d \
            --name home-frontend-1 \
            -p 5173:80 \
            home-frontend
        '''
      }
    }
  }

  post {
    success {
      echo '✅ Frontend deployed successfully!'
    }
    failure {
      echo '❌ Frontend deployment failed – check the console output above.'
    }
  }
}
